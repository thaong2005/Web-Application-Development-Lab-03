<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Form Validator</title>
    <style>
        .form-container {
            max-width: 450px;
            margin: 50px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            font-family: Arial, sans-serif;
            background-color: #ffffff;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input {
            width: 95%;
            position: relative;
            padding: 10px;

            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        input.valid {
            border-color: #28a745;
        }
        
        input.invalid {
            border-color: red;
        }
        
        .error-message {
            color: red;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        button[type="submit"] {
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        button[type="submit"]:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>Sign Up Form</h2>
        <form id="signupForm">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter username">
                <span class="status" id="usernameStatus" aria-hidden="true"></span>
                <div class="error-message" id="usernameError"></div>
            </div>
            
            <div class="form-group">
                <label for="email">Email</label>
                <input type="text" id="email" placeholder="Enter email">
                <span class="status" id="emailStatus" aria-hidden="true"></span>
                <div class="error-message" id="emailError"></div>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter password">
                <span class="status" id="passwordStatus" aria-hidden="true"></span>
                <div class="error-message" id="passwordError"></div>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm password">
                <span class="status" id="confirmPasswordStatus" aria-hidden="true"></span>
                <div class="error-message" id="confirmPasswordError"></div>
            </div>
            
            <button type="submit" id="submitBtn" disabled>Sign Up</button>
        </form>
    </div>

    <script>
        /*
         * Phiên bản đơn giản hơn của form validator với comment bằng tiếng Việt.
         * - Mỗi trường có validator ngắn gọn
         * - Khi input thay đổi, validate trường đó và cập nhật trạng thái nút Submit
         * - Các helper showFieldError/clearField giúp quản lý UI (class, thông báo)
         */

        // Các validator: nhận chuỗi, trả về true/false
        const validators = {
            username: v => /^[a-zA-Z0-9_]{4,20}$/.test(v), // 4-20 ký tự, chữ/số/underscore
            email: v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v), // pattern email đơn giản
            password: v => /^(?=.*[A-Z])(?=.*\d).{8,}$/.test(v), // ít nhất 8 ký tự, 1 hoa, 1 số
            confirmPassword: (v, all) => v === all.password && v.length > 0 // khớp password
        };

        // Hiển thị lỗi cho trường
        function showFieldError(id, msg) {
            const err = document.getElementById(id + 'Error');
            const input = document.getElementById(id);
            if (err) { err.textContent = msg; err.classList.add('show'); }
            if (input) { input.classList.remove('valid'); input.classList.add('invalid'); input.setAttribute('aria-invalid', 'true'); }
            const status = document.getElementById(id + 'Status');
            if (status) { status.textContent = '✗'; status.style.color = 'red'; }
        }

        // Xoá lỗi (đánh dấu valid)
        function clearFieldError(id) {
            const err = document.getElementById(id + 'Error');
            const input = document.getElementById(id);
            if (err) { err.textContent = ''; err.classList.remove('show'); }
            if (input) { input.classList.remove('invalid'); input.classList.add('valid'); input.setAttribute('aria-invalid', 'false'); }
            const status = document.getElementById(id + 'Status');
            if (status) { status.textContent = '✓'; status.style.color = 'green'; }
        }

        // Lấy giá trị hiện tại của tất cả trường để validator confirmPassword có thể so sánh
        function getAllValues() {
            return {
                username: document.getElementById('username').value.trim(),
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value
            };
        }

        // Validate một trường cụ thể, cập nhật UI và trả về true/false
        function validateField(id) {
            const all = getAllValues();
            const value = all[id];
            const valid = id === 'confirmPassword' ? validators[id](value, all) : validators[id](value);
            if (!valid) {
                // thông điệp ngắn gọn cho mỗi field
                const msgs = {
                    username: 'Username must be 4-20 chars (letters, numbers, _)',
                    email: 'Email is invalid',
                    password: 'Password must be at least 8 chars, 1 uppercase letter and 1 number',
                    confirmPassword: 'Passwords do not match'
                };
                showFieldError(id, msgs[id]);
            } else {
                clearFieldError(id);
            }
            return valid;
        }

        // Kiểm tra toàn bộ form và bật/tắt nút submit
        function validateForm() {
            const fields = ['username','email','password','confirmPassword'];
            const results = fields.map(f => validateField(f));
            const allValid = results.every(Boolean);
            document.getElementById('submitBtn').disabled = !allValid;
            return allValid;
        }

        // Gắn sự kiện input cho mỗi trường để validate realtime
        ['username','email','password','confirmPassword'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('input', validateForm);
        });

        // Xử lý submit: preventDefault và hiển thị thông báo
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (validateForm()) {
                alert('Form submitted successfully!');
                this.reset();
                // sau khi reset, xóa trạng thái valid để giao diện trở về ban đầu
                ['username','email','password','confirmPassword'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.remove('valid');
                    const status = document.getElementById(id + 'Status'); if (status) status.textContent = '';
                    const err = document.getElementById(id + 'Error'); if (err) err.textContent = '';
                });
                document.getElementById('submitBtn').disabled = true;
            }
        });

        // Khởi tạo trạng thái ban đầu
        document.addEventListener('DOMContentLoaded', validateForm);
    </script>
</body>
</html>